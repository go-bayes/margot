<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate QINI Curves and Difference Gain Summaries — margot_qini • margot</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Sans-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate QINI Curves and Difference Gain Summaries — margot_qini"><meta name="description" content="Computes QINI curves and difference gain summaries for causal forest models.
This function provides a direct way to generate QINI results without running
full policy analysis, paralleling the functionality of margot_rate()."><meta property="og:description" content="Computes QINI curves and difference gain summaries for causal forest models.
This function provides a direct way to generate QINI results without running
full policy analysis, paralleling the functionality of margot_rate()."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">margot</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.210</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/go-bayes/margot/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate QINI Curves and Difference Gain Summaries</h1>
      <small class="dont-index">Source: <a href="https://github.com/go-bayes/margot/blob/HEAD/R/margot_qini.R" class="external-link"><code>R/margot_qini.R</code></a></small>
      <div class="d-none name"><code>margot_qini.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Computes QINI curves and difference gain summaries for causal forest models.
This function provides a direct way to generate QINI results without running
full policy analysis, paralleling the functionality of margot_rate().</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">margot_qini</span><span class="op">(</span></span>
<span>  <span class="va">models</span>,</span>
<span>  model_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spend_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>  baseline_method <span class="op">=</span> <span class="st">"maq_no_covariates"</span>,</span>
<span>  label_mapping <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  remove_tx_prefix <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  remove_z_suffix <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  use_title_case <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  remove_underscores <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>  treatment_cost <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-models">models<a class="anchor" aria-label="anchor" href="#arg-models"></a></dt>
<dd><p>List returned by margot_causal_forest(), containing results
and optionally full_models.</p></dd>


<dt id="arg-model-names">model_names<a class="anchor" aria-label="anchor" href="#arg-model-names"></a></dt>
<dd><p>Optional character vector specifying which models to process.
Default NULL (all models).</p></dd>


<dt id="arg-spend-levels">spend_levels<a class="anchor" aria-label="anchor" href="#arg-spend-levels"></a></dt>
<dd><p>Numeric vector of spend levels for difference gain summaries.
Default is c(0.1, 0.4).</p></dd>


<dt id="arg-baseline-method">baseline_method<a class="anchor" aria-label="anchor" href="#arg-baseline-method"></a></dt>
<dd><p>Method for generating baseline: "maq_no_covariates" (default),
"auto", "simple", "maq_only", or "none". See margot_generate_qini_data() for details.</p></dd>


<dt id="arg-label-mapping">label_mapping<a class="anchor" aria-label="anchor" href="#arg-label-mapping"></a></dt>
<dd><p>Named character vector for converting variable names to readable labels.</p></dd>


<dt id="arg-remove-tx-prefix">remove_tx_prefix<a class="anchor" aria-label="anchor" href="#arg-remove-tx-prefix"></a></dt>
<dd><p>Logical; remove treatment prefix from variable names (default TRUE).</p></dd>


<dt id="arg-remove-z-suffix">remove_z_suffix<a class="anchor" aria-label="anchor" href="#arg-remove-z-suffix"></a></dt>
<dd><p>Logical; remove z-score suffix from variable names (default TRUE).</p></dd>


<dt id="arg-use-title-case">use_title_case<a class="anchor" aria-label="anchor" href="#arg-use-title-case"></a></dt>
<dd><p>Logical; convert variable names to title case (default TRUE).</p></dd>


<dt id="arg-remove-underscores">remove_underscores<a class="anchor" aria-label="anchor" href="#arg-remove-underscores"></a></dt>
<dd><p>Logical; replace underscores with spaces (default TRUE).</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical; print progress messages (default TRUE).</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Integer; base seed for reproducible computations (default 12345).</p></dd>


<dt id="arg-treatment-cost">treatment_cost<a class="anchor" aria-label="anchor" href="#arg-treatment-cost"></a></dt>
<dd><p>Scalar treatment cost per unit. Default 1. Lower values (e.g., 0.2)
represent cheap treatments; higher values (e.g., 5) represent expensive treatments.
Affects QINI curve shape - lower costs create steeper curves, higher costs create
shallower curves.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list where each element corresponds to a model and contains:</p><ul><li><p><code>qini_objects</code>: maq objects for CATE and baseline curves</p></li>
<li><p><code>qini_data</code>: data.frame with proportion, gain, and curve columns for plotting</p></li>
<li><p><code>diff_gain_summaries</code>: list of difference gain summaries at each spend level</p></li>
<li><p><code>model_name</code>: the processed model name</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function generates QINI curves on-demand using margot_generate_qini_data().
For binary treatments, it creates both CATE and baseline (e.g., ATE) curves.
The difference gain summaries quantify how much better CATE-based targeting
performs compared to the baseline at specified spend levels.</p>
<p>The treatment_cost parameter allows for cost sensitivity analysis without
rerunning the causal forest models. Lower costs (e.g., 0.2) create steeper
QINI curves indicating more people can be treated cost-effectively, while
higher costs (e.g., 5) create shallower curves indicating only the highest-effect
individuals justify treatment.</p>
<p><strong>Cost Invariance Property</strong>: When treatment costs are uniform across
individuals, the relative benefit of CATE-based targeting over uniform allocation
remains constant regardless of cost level. While absolute gains scale inversely
with cost (gain at cost c = gain at cost 1 / c), the difference between CATE
and ATE curves scales proportionally, preserving the relative advantage of
personalized treatment. This means the value of heterogeneous treatment effects
for targeting decisions is independent of the uniform cost level.</p>
<p>The output is structured to be compatible with margot_interpret_qini() and
other QINI visualization functions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Generate QINI results for all models</span></span></span>
<span class="r-in"><span><span class="va">qini_results</span> <span class="op">&lt;-</span> <span class="fu">margot_qini</span><span class="op">(</span><span class="va">causal_forest_results</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate for specific models with custom spend levels</span></span></span>
<span class="r-in"><span><span class="va">qini_results</span> <span class="op">&lt;-</span> <span class="fu">margot_qini</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">causal_forest_results</span>,</span></span>
<span class="r-in"><span>  model_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"model_anxiety"</span>, <span class="st">"model_depression"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  spend_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  baseline_method <span class="op">=</span> <span class="st">"simple"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Cost sensitivity analysis - vary treatment cost without rerunning forests</span></span></span>
<span class="r-in"><span><span class="co"># Low cost scenario (cheap treatment)</span></span></span>
<span class="r-in"><span><span class="va">qini_low_cost</span> <span class="op">&lt;-</span> <span class="fu">margot_qini</span><span class="op">(</span><span class="va">causal_forest_results</span>, treatment_cost <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Medium cost scenario (default)</span></span></span>
<span class="r-in"><span><span class="va">qini_med_cost</span> <span class="op">&lt;-</span> <span class="fu">margot_qini</span><span class="op">(</span><span class="va">causal_forest_results</span>, treatment_cost <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># High cost scenario (expensive treatment)</span></span></span>
<span class="r-in"><span><span class="va">qini_high_cost</span> <span class="op">&lt;-</span> <span class="fu">margot_qini</span><span class="op">(</span><span class="va">causal_forest_results</span>, treatment_cost <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare results across cost scenarios</span></span></span>
<span class="r-in"><span><span class="fu"><a href="margot_plot_qini.html">margot_plot_qini</a></span><span class="op">(</span><span class="va">qini_low_cost</span><span class="op">$</span><span class="va">model_anxiety</span>, title <span class="op">=</span> <span class="st">"Anxiety - Low Cost"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="margot_plot_qini.html">margot_plot_qini</a></span><span class="op">(</span><span class="va">qini_high_cost</span><span class="op">$</span><span class="va">model_anxiety</span>, title <span class="op">=</span> <span class="st">"Anxiety - High Cost"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use helper function for systematic cost sensitivity analysis</span></span></span>
<span class="r-in"><span><span class="va">cost_sensitivity</span> <span class="op">&lt;-</span> <span class="fu"><a href="margot_qini_cost_sensitivity.html">margot_qini_cost_sensitivity</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">causal_forest_results</span>,</span></span>
<span class="r-in"><span>  costs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  model_names <span class="op">=</span> <span class="st">"model_anxiety"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Interpret the results</span></span></span>
<span class="r-in"><span><span class="va">interpretation</span> <span class="op">&lt;-</span> <span class="fu"><a href="margot_interpret_qini.html">margot_interpret_qini</a></span><span class="op">(</span><span class="va">qini_results</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/go-bayes" class="external-link">Joseph A Bulbulia</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

