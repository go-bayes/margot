<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate QINI Curves and Difference Gain Summaries — margot_qini • margot</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Sans-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate QINI Curves and Difference Gain Summaries — margot_qini"><meta name="description" content="Computes QINI curves and difference gain summaries for causal forest models.
This function provides a direct way to generate QINI results without running
full policy analysis, paralleling the functionality of margot_rate().
Computes QINI curves for causal forest models using the exact methodology
from GRF/MAQ packages. Uses test set data when train/test splits were used
in margot_causal_forest().
This function provides backward compatibility for margot_interpret_qini by
formatting the output of margot_qini_alternative into the expected structure."><meta property="og:description" content="Computes QINI curves and difference gain summaries for causal forest models.
This function provides a direct way to generate QINI results without running
full policy analysis, paralleling the functionality of margot_rate().
Computes QINI curves for causal forest models using the exact methodology
from GRF/MAQ packages. Uses test set data when train/test splits were used
in margot_causal_forest().
This function provides backward compatibility for margot_interpret_qini by
formatting the output of margot_qini_alternative into the expected structure."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">margot</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.250</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/go-bayes/margot/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate QINI Curves and Difference Gain Summaries</h1>
      <small class="dont-index">Source: <a href="https://github.com/go-bayes/margot/blob/HEAD/R/margot_qini.R" class="external-link"><code>R/margot_qini.R</code></a>, <a href="https://github.com/go-bayes/margot/blob/HEAD/R/margot_qini_new.R" class="external-link"><code>R/margot_qini_new.R</code></a>, <a href="https://github.com/go-bayes/margot/blob/HEAD/R/margot_qini_wrapper.R" class="external-link"><code>R/margot_qini_wrapper.R</code></a></small>
      <div class="d-none name"><code>margot_qini.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Computes QINI curves and difference gain summaries for causal forest models.
This function provides a direct way to generate QINI results without running
full policy analysis, paralleling the functionality of margot_rate().</p>
<p>Computes QINI curves for causal forest models using the exact methodology
from GRF/MAQ packages. Uses test set data when train/test splits were used
in margot_causal_forest().</p>
<p>This function provides backward compatibility for margot_interpret_qini by
formatting the output of margot_qini_alternative into the expected structure.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">margot_qini</span><span class="op">(</span></span>
<span>  <span class="va">margot_result</span>,</span>
<span>  model_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>  n_bootstrap <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spend_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>  label_mapping <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">margot_qini</span><span class="op">(</span></span>
<span>  <span class="va">margot_result</span>,</span>
<span>  model_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>  n_bootstrap <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spend_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>  label_mapping <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">margot_qini</span><span class="op">(</span></span>
<span>  <span class="va">margot_result</span>,</span>
<span>  model_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>  n_bootstrap <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spend_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.4</span><span class="op">)</span>,</span>
<span>  label_mapping <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-margot-result">margot_result<a class="anchor" aria-label="anchor" href="#arg-margot-result"></a></dt>
<dd><p>Output from margot_causal_forest()</p></dd>


<dt id="arg-model-names">model_names<a class="anchor" aria-label="anchor" href="#arg-model-names"></a></dt>
<dd><p>Character vector of model names to process (NULL = all)</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Random seed for reproducibility</p></dd>


<dt id="arg-n-bootstrap">n_bootstrap<a class="anchor" aria-label="anchor" href="#arg-n-bootstrap"></a></dt>
<dd><p>Number of bootstrap replicates for confidence intervals</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Print progress messages</p></dd>


<dt id="arg-spend-levels">spend_levels<a class="anchor" aria-label="anchor" href="#arg-spend-levels"></a></dt>
<dd><p>Numeric vector of spend levels for analysis (default 0.1)</p></dd>


<dt id="arg-label-mapping">label_mapping<a class="anchor" aria-label="anchor" href="#arg-label-mapping"></a></dt>
<dd><p>Named list for label transformations</p></dd>


<dt id="arg-models">models<a class="anchor" aria-label="anchor" href="#arg-models"></a></dt>
<dd><p>List returned by margot_causal_forest(), containing results
and optionally full_models.</p></dd>


<dt id="arg-baseline-method">baseline_method<a class="anchor" aria-label="anchor" href="#arg-baseline-method"></a></dt>
<dd><p>Method for generating baseline: "maq_no_covariates" (default),
"auto", "simple", "maq_only", or "none". See margot_generate_qini_data() for details.</p></dd>


<dt id="arg-remove-tx-prefix">remove_tx_prefix<a class="anchor" aria-label="anchor" href="#arg-remove-tx-prefix"></a></dt>
<dd><p>Logical; remove treatment prefix from variable names (default TRUE).</p></dd>


<dt id="arg-remove-z-suffix">remove_z_suffix<a class="anchor" aria-label="anchor" href="#arg-remove-z-suffix"></a></dt>
<dd><p>Logical; remove z-score suffix from variable names (default TRUE).</p></dd>


<dt id="arg-use-title-case">use_title_case<a class="anchor" aria-label="anchor" href="#arg-use-title-case"></a></dt>
<dd><p>Logical; convert variable names to title case (default TRUE).</p></dd>


<dt id="arg-remove-underscores">remove_underscores<a class="anchor" aria-label="anchor" href="#arg-remove-underscores"></a></dt>
<dd><p>Logical; replace underscores with spaces (default TRUE).</p></dd>


<dt id="arg-treatment-cost">treatment_cost<a class="anchor" aria-label="anchor" href="#arg-treatment-cost"></a></dt>
<dd><p>Scalar treatment cost per unit. Default 1. Lower values (e.g., 0.2)
represent cheap treatments; higher values (e.g., 5) represent expensive treatments.
Affects QINI curve shape - lower costs create steeper curves, higher costs create
shallower curves.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list where each element corresponds to a model and contains:
  qini_objects (maq objects for CATE and baseline curves),
  qini_data (data.frame with proportion, gain, and curve columns for plotting),
  diff_gain_summaries (list of difference gain summaries at each spend level),
  model_name (the processed model name).</p>
<p>The input margot_result object with added qini_results component containing:</p>
<dl><dt>cate</dt>
<dd><p>MAQ object for CATE-based targeting</p></dd>

  <dt>baseline</dt>
<dd><p>MAQ object for no-priority baseline</p></dd>

  <dt>test_indices</dt>
<dd><p>Indices used for QINI computation</p></dd>

  <dt>n_test</dt>
<dd><p>Number of observations used</p></dd>


</dl><p>List formatted for margot_interpret_qini with diff_gain_summaries</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function generates QINI curves on-demand using margot_generate_qini_data().
For binary treatments, it creates both CATE and baseline (e.g., ATE) curves.
The difference gain summaries quantify how much better CATE-based targeting
performs compared to the baseline at specified spend levels.</p>
<p>The treatment_cost parameter allows for cost sensitivity analysis without
rerunning the causal forest models. Lower costs (e.g., 0.2) create steeper
QINI curves indicating more people can be treated cost-effectively, while
higher costs (e.g., 5) create shallower curves indicating only the highest-effect
individuals justify treatment.</p>
<p>Cost Invariance Property: When treatment costs are uniform across
individuals, the relative benefit of CATE-based targeting over uniform allocation
remains constant regardless of cost level. While absolute gains scale inversely
with cost (gain at cost c = gain at cost 1 / c), the difference between CATE
and ATE curves scales proportionally, preserving the relative advantage of
personalized treatment. This means the value of heterogeneous treatment effects
for targeting decisions is independent of the uniform cost level.</p>
<p>The output is structured to be compatible with margot_interpret_qini() and
other QINI visualization functions.</p>
<p>This function implements the standard QINI curve methodology from the GRF
and MAQ packages. It computes two curves:</p>
<p>1. CATE curve: Prioritizes treatment based on estimated individual treatment effects
2. Baseline curve: No-priority assignment (random allocation)</p>
<p>When margot_causal_forest() was run with use_train_test_split = TRUE,
QINI curves are computed on the test set only, following best practices
for avoiding overfitting in policy evaluation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Run causal forest with train/test split</span></span></span>
<span class="r-in"><span><span class="va">cf_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="margot_causal_forest.html">margot_causal_forest</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">mydata</span>,</span></span>
<span class="r-in"><span>  outcome_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"outcome1"</span>, <span class="st">"outcome2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  covariates <span class="op">=</span> <span class="va">covariates</span>,</span></span>
<span class="r-in"><span>  W <span class="op">=</span> <span class="va">treatment</span>,</span></span>
<span class="r-in"><span>  use_train_test_split <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute QINI curves</span></span></span>
<span class="r-in"><span><span class="va">cf_results</span> <span class="op">&lt;-</span> <span class="fu">margot_qini</span><span class="op">(</span><span class="va">cf_results</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="margot_plot_qini.html">margot_plot_qini</a></span><span class="op">(</span><span class="va">cf_results</span>, model_name <span class="op">=</span> <span class="st">"model_outcome1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/go-bayes" class="external-link">Joseph A Bulbulia</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

