<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Stability Analysis for Policy Trees — margot_policy_tree_stability • margot</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Sans-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stability Analysis for Policy Trees — margot_policy_tree_stability"><meta name="description" content="Performs stability analysis of policy trees to assess robustness and generate
consensus trees. By default, varies random seeds to create different train/test
splits to assess stability. Optionally supports bootstrap resampling for
traditional bootstrap analysis. Uses memory-efficient streaming approach to
handle large datasets."><meta property="og:description" content="Performs stability analysis of policy trees to assess robustness and generate
consensus trees. By default, varies random seeds to create different train/test
splits to assess stability. Optionally supports bootstrap resampling for
traditional bootstrap analysis. Uses memory-efficient streaming approach to
handle large datasets."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">margot</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.260</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/go-bayes/margot/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Stability Analysis for Policy Trees</h1>
      <small class="dont-index">Source: <a href="https://github.com/go-bayes/margot/blob/HEAD/R/margot_policy_tree_stability.R" class="external-link"><code>R/margot_policy_tree_stability.R</code></a></small>
      <div class="d-none name"><code>margot_policy_tree_stability.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs stability analysis of policy trees to assess robustness and generate
consensus trees. By default, varies random seeds to create different train/test
splits to assess stability. Optionally supports bootstrap resampling for
traditional bootstrap analysis. Uses memory-efficient streaming approach to
handle large datasets.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">margot_policy_tree_stability</span><span class="op">(</span></span>
<span>  <span class="va">model_results</span>,</span>
<span>  model_names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  custom_covariates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  exclude_covariates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  covariate_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"original"</span>, <span class="st">"custom"</span>, <span class="st">"add"</span>, <span class="st">"all"</span><span class="op">)</span>,</span>
<span>  depth <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_iterations <span class="op">=</span> <span class="fl">300</span>,</span>
<span>  vary_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"split_only"</span>, <span class="st">"bootstrap"</span>, <span class="st">"both"</span><span class="op">)</span>,</span>
<span>  consensus_threshold <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  train_proportion <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  vary_train_proportion <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  train_proportions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>  label_mapping <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  return_consensus_trees <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  metaseed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>  parrallel <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>  tree_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fastpolicytree"</span>, <span class="st">"policytree"</span><span class="op">)</span>,</span>
<span>  n_bootstrap <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  compute_policy_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  policy_value_R <span class="op">=</span> <span class="fl">499L</span>,</span>
<span>  policy_value_seed <span class="op">=</span> <span class="fl">42L</span>,</span>
<span>  policy_value_baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"control_all"</span>, <span class="st">"treat_all"</span><span class="op">)</span>,</span>
<span>  future_globals_max_size <span class="op">=</span> <span class="fl">20</span> <span class="op">*</span> <span class="fl">1024</span><span class="op">^</span><span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-model-results">model_results<a class="anchor" aria-label="anchor" href="#arg-model-results"></a></dt>
<dd><p>List returned by margot_causal_forest() or margot_flip_forests()</p></dd>


<dt id="arg-model-names">model_names<a class="anchor" aria-label="anchor" href="#arg-model-names"></a></dt>
<dd><p>Character vector of model names to analyze. NULL = all models.</p></dd>


<dt id="arg-custom-covariates">custom_covariates<a class="anchor" aria-label="anchor" href="#arg-custom-covariates"></a></dt>
<dd><p>Character vector of covariate names to use for policy trees.
If NULL, uses the original top variables from the model.</p></dd>


<dt id="arg-exclude-covariates">exclude_covariates<a class="anchor" aria-label="anchor" href="#arg-exclude-covariates"></a></dt>
<dd><p>Character vector of covariate names or patterns to exclude.
Supports exact matches and regex patterns (e.g., "_log" excludes all variables
containing "_log").</p></dd>


<dt id="arg-covariate-mode">covariate_mode<a class="anchor" aria-label="anchor" href="#arg-covariate-mode"></a></dt>
<dd><p>Character string specifying how to handle covariates:
"original" (use original top variables), "custom" (use only custom_covariates),
"add" (add custom to existing), "all" (use all available covariates).</p></dd>


<dt id="arg-depth">depth<a class="anchor" aria-label="anchor" href="#arg-depth"></a></dt>
<dd><p>Numeric or character specifying which depth(s) to compute:
1 for single split, 2 for two splits (default), or "both" for both depths.</p></dd>


<dt id="arg-n-iterations">n_iterations<a class="anchor" aria-label="anchor" href="#arg-n-iterations"></a></dt>
<dd><p>Integer. Number of stability iterations (default 300).</p></dd>


<dt id="arg-vary-type">vary_type<a class="anchor" aria-label="anchor" href="#arg-vary-type"></a></dt>
<dd><p>Character. Type of variation: "split_only" (vary train/test split via seeds),
"bootstrap" (bootstrap resample), "both" (resample + split). Default is "split_only".</p></dd>


<dt id="arg-consensus-threshold">consensus_threshold<a class="anchor" aria-label="anchor" href="#arg-consensus-threshold"></a></dt>
<dd><p>Numeric. Minimum inclusion frequency for consensus (default 0.5).</p></dd>


<dt id="arg-train-proportion">train_proportion<a class="anchor" aria-label="anchor" href="#arg-train-proportion"></a></dt>
<dd><p>Numeric. Train/test split when vary_train_proportion = FALSE (default 0.5).</p></dd>


<dt id="arg-vary-train-proportion">vary_train_proportion<a class="anchor" aria-label="anchor" href="#arg-vary-train-proportion"></a></dt>
<dd><p>Logical. Whether to vary train proportion (default FALSE).</p></dd>


<dt id="arg-train-proportions">train_proportions<a class="anchor" aria-label="anchor" href="#arg-train-proportions"></a></dt>
<dd><p>Numeric vector. Proportions to cycle through when
vary_train_proportion = TRUE (default c(0.4, 0.5, 0.6, 0.7)).</p></dd>


<dt id="arg-label-mapping">label_mapping<a class="anchor" aria-label="anchor" href="#arg-label-mapping"></a></dt>
<dd><p>Named character vector for converting variable names to readable labels.</p></dd>


<dt id="arg-return-consensus-trees">return_consensus_trees<a class="anchor" aria-label="anchor" href="#arg-return-consensus-trees"></a></dt>
<dd><p>Logical. Return fitted consensus trees (default TRUE).</p></dd>


<dt id="arg-metaseed">metaseed<a class="anchor" aria-label="anchor" href="#arg-metaseed"></a></dt>
<dd><p>Integer. Master seed for reproducibility (default 12345).</p></dd>


<dt id="arg-parrallel">parrallel<a class="anchor" aria-label="anchor" href="#arg-parrallel"></a></dt>
<dd><p>Deprecated misspelling of `parallel`; retained for backwards compatibility.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Logical. Use parallel processing (default FALSE).</p></dd>


<dt id="arg-n-cores">n_cores<a class="anchor" aria-label="anchor" href="#arg-n-cores"></a></dt>
<dd><p>Integer. Number of cores for parallel processing.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. Print progress messages (default TRUE).</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Integer. Additional seed parameter for compatibility (default 12345).</p></dd>


<dt id="arg-tree-method">tree_method<a class="anchor" aria-label="anchor" href="#arg-tree-method"></a></dt>
<dd><p>Character string specifying the package to use: "fastpolicytree"
(default) or "policytree". The fastpolicytree package provides ~10x faster
computation, which is particularly beneficial for stability analysis. Falls
back to policytree if fastpolicytree is not installed.</p></dd>


<dt id="arg-n-bootstrap">n_bootstrap<a class="anchor" aria-label="anchor" href="#arg-n-bootstrap"></a></dt>
<dd><p>Deprecated. Use n_iterations instead.</p></dd>


<dt id="arg-compute-policy-values">compute_policy_values<a class="anchor" aria-label="anchor" href="#arg-compute-policy-values"></a></dt>
<dd><p>Logical. If TRUE, compute bootstrap policy-value tests for
each consensus tree and store results in `policy_value_depth_*` slots (default FALSE).</p></dd>


<dt id="arg-policy-value-r">policy_value_R<a class="anchor" aria-label="anchor" href="#arg-policy-value-r"></a></dt>
<dd><p>Integer ≥ 1. Number of bootstrap replicates for policy values when
`compute_policy_values = TRUE` (default 499).</p></dd>


<dt id="arg-policy-value-seed">policy_value_seed<a class="anchor" aria-label="anchor" href="#arg-policy-value-seed"></a></dt>
<dd><p>Optional integer seed for policy-value bootstraps. Use NULL to
inherit the ambient RNG state.</p></dd>


<dt id="arg-policy-value-baseline">policy_value_baseline<a class="anchor" aria-label="anchor" href="#arg-policy-value-baseline"></a></dt>
<dd><p>Contrast baseline for stored policy values when
`compute_policy_values = TRUE`. One of "control_all" (default) or "treat_all".</p></dd>


<dt id="arg-future-globals-max-size">future_globals_max_size<a class="anchor" aria-label="anchor" href="#arg-future-globals-max-size"></a></dt>
<dd><p>Maximum size (in bytes) of globals that can be exported to
parallel workers when `parallel = TRUE`. Defaults to 20 GiB. Increase this if large model
objects trigger the `future.globals.maxSize` guard.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Object of class "margot_stability_policy_tree" containing:</p><ul><li><p>results: List with consensus trees and stability metrics per model</p></li>
<li><p>summary_metrics: Variable importance and convergence diagnostics</p></li>
<li><p>metadata: Analysis parameters and seeds used</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function uses a memory-efficient approach:</p><ul><li><p>Processes one tree at a time</p></li>
<li><p>Extracts only essential split information</p></li>
<li><p>Accumulates statistics without storing all trees</p></li>
<li><p>Reconstructs single consensus trees for compatibility</p></li>
</ul><p>When `compute_policy_values = TRUE`, each consensus tree is also evaluated
against the specified baseline and bootstrap policy-value estimates are stored
in `policy_value_depth_1` / `policy_value_depth_2`. This allows downstream
reporters to reuse consistent estimates without rerunning the bootstrap.</p>
<p>By default, the function varies random seeds to create different train/test splits
for each iteration. This assesses the stability of the policy tree structure
without the computational overhead and statistical assumptions of bootstrap
resampling. True bootstrap resampling can be enabled with vary_type = "bootstrap".</p>
    </div>
    <div class="section level2">
    <h2 id="theoretical-background">Theoretical Background<a class="anchor" aria-label="anchor" href="#theoretical-background"></a></h2>


<p>Policy trees inherit the instability of decision trees, where small changes in
the data can lead to completely different tree structures (Breiman, 1996). This
instability is particularly pronounced when predictors are correlated, as the tree
can arbitrarily choose between similar variables at split points. Athey and Wager's
(2021) policy learning framework acknowledges these challenges while providing
methods to extract robust insights despite the instability.</p>
<p>The stability analysis helps distinguish between:</p><ul><li><p>Fundamental instability due to weak or absent treatment effect heterogeneity</p></li>
<li><p>Apparent instability due to correlated predictors that capture similar information</p></li>
<li><p>Robust patterns that emerge consistently across different data samples</p></li>
</ul><p>Use the companion functions `margot_assess_variable_correlation()` and
`margot_stability_diagnostics()` to better understand the sources of instability.</p>
<p>Three types of variation are supported:</p><ul><li><p>"split_only": Fixed sample, only varies train/test split (default)</p></li>
<li><p>"bootstrap": Bootstrap resampling with replacement</p></li>
<li><p>"both": Varies both bootstrap sampling and train/test splits</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="complete-workflow-example">Complete Workflow Example<a class="anchor" aria-label="anchor" href="#complete-workflow-example"></a></h2>


<div class="sourceCode"><pre><code><span></span>
<span><span class="co"># 1. Run causal forest (save data for correlation analysis)</span></span>
<span><span class="va">cf_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_causal_forest.html">margot_causal_forest</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">your_data</span>,</span>
<span>  outcome_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"outcome1"</span>, <span class="st">"outcome2"</span><span class="op">)</span>,</span>
<span>  save_data <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Important for correlation analysis</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Run stability analysis to assess robustness</span></span>
<span><span class="va">stability_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_policy_tree_stability.html">margot_policy_tree_stability</a></span><span class="op">(</span></span>
<span>  <span class="va">cf_results</span>,</span>
<span>  n_iterations <span class="op">=</span> <span class="fl">300</span>,</span>
<span>  tree_method <span class="op">=</span> <span class="st">"fastpolicytree"</span>  <span class="co"># 10x faster if available</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Check variable correlations</span></span>
<span><span class="va">cor_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_assess_variable_correlation.html">margot_assess_variable_correlation</a></span><span class="op">(</span></span>
<span>  <span class="va">cf_results</span>,  <span class="co"># Use original results, NOT stability_results</span></span>
<span>  <span class="st">"model_outcome1"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Identify clusters of correlated variables</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_identify_variable_clusters.html">margot_identify_variable_clusters</a></span><span class="op">(</span><span class="va">cor_analysis</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Get comprehensive diagnostics</span></span>
<span><span class="va">diagnostics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_stability_diagnostics.html">margot_stability_diagnostics</a></span><span class="op">(</span></span>
<span>  stability_results <span class="op">=</span> <span class="va">stability_results</span>,</span>
<span>  model_results <span class="op">=</span> <span class="va">cf_results</span>,</span>
<span>  model_name <span class="op">=</span> <span class="st">"model_outcome1"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 6. Interpret results</span></span>
<span><span class="va">interpretation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/margot_interpret_stability.html">margot_interpret_stability</a></span><span class="op">(</span></span>
<span>  <span class="va">stability_results</span>,</span>
<span>  <span class="st">"model_outcome1"</span>,</span>
<span>  include_theory <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Include theoretical context</span></span>
<span><span class="op">)</span></span></code></pre></div>

    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Athey, S., &amp; Wager, S. (2021). Policy learning with observational data.
Econometrica, 89(1), 133-161.</p>
<p>Breiman, L. (1996). Bagging predictors. Machine Learning, 24(2), 123-140.</p>
<p>Zhou, Z., Athey, S., &amp; Wager, S. (2023). Offline multi-action policy learning:
Generalization and optimization. Operations Research, 71(1), 148-183.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="margot_policy_tree.html">margot_policy_tree</a></code> for computing policy trees without stability analysis
<code><a href="margot_assess_variable_correlation.html">margot_assess_variable_correlation</a></code> for correlation analysis
<code><a href="margot_stability_diagnostics.html">margot_stability_diagnostics</a></code> for comprehensive diagnostics</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Basic stability analysis with fixed train proportion</span></span></span>
<span class="r-in"><span><span class="va">stability_results</span> <span class="op">&lt;-</span> <span class="fu">margot_policy_tree_stability</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">causal_forest_results</span>,</span></span>
<span class="r-in"><span>  n_iterations <span class="op">=</span> <span class="fl">300</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Vary train proportion with default values</span></span></span>
<span class="r-in"><span><span class="va">stability_results</span> <span class="op">&lt;-</span> <span class="fu">margot_policy_tree_stability</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">causal_forest_results</span>,</span></span>
<span class="r-in"><span>  vary_train_proportion <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom train proportions</span></span></span>
<span class="r-in"><span><span class="va">stability_results</span> <span class="op">&lt;-</span> <span class="fu">margot_policy_tree_stability</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">causal_forest_results</span>,</span></span>
<span class="r-in"><span>  vary_train_proportion <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  train_proportions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use bootstrap resampling instead of seed variation</span></span></span>
<span class="r-in"><span><span class="va">stability_results</span> <span class="op">&lt;-</span> <span class="fu">margot_policy_tree_stability</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">causal_forest_results</span>,</span></span>
<span class="r-in"><span>  vary_type <span class="op">=</span> <span class="st">"bootstrap"</span>,</span></span>
<span class="r-in"><span>  n_iterations <span class="op">=</span> <span class="fl">300</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot consensus tree</span></span></span>
<span class="r-in"><span><span class="fu"><a href="margot_plot_policy_tree.html">margot_plot_policy_tree</a></span><span class="op">(</span><span class="va">stability_results</span>, <span class="st">"model_anxiety"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get stability summary</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">stability_results</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Interpret results with theoretical context</span></span></span>
<span class="r-in"><span><span class="va">interpretation</span> <span class="op">&lt;-</span> <span class="fu"><a href="margot_interpret_stability.html">margot_interpret_stability</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">stability_results</span>,</span></span>
<span class="r-in"><span>  <span class="st">"model_anxiety"</span>,</span></span>
<span class="r-in"><span>  format <span class="op">=</span> <span class="st">"text"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assess variable correlations (using original causal forest results)</span></span></span>
<span class="r-in"><span><span class="va">cor_analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="margot_assess_variable_correlation.html">margot_assess_variable_correlation</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">causal_forest_results</span>, <span class="co"># NOT stability_results</span></span></span>
<span class="r-in"><span>  <span class="st">"model_anxiety"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Identify variable clusters</span></span></span>
<span class="r-in"><span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="margot_identify_variable_clusters.html">margot_identify_variable_clusters</a></span><span class="op">(</span><span class="va">cor_analysis</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run comprehensive stability diagnostics</span></span></span>
<span class="r-in"><span><span class="va">diagnostics</span> <span class="op">&lt;-</span> <span class="fu"><a href="margot_stability_diagnostics.html">margot_stability_diagnostics</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  stability_results <span class="op">=</span> <span class="va">stability_results</span>,</span></span>
<span class="r-in"><span>  model_results <span class="op">=</span> <span class="va">causal_forest_results</span>,</span></span>
<span class="r-in"><span>  model_name <span class="op">=</span> <span class="st">"model_anxiety"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/go-bayes" class="external-link">Joseph A Bulbulia</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

