<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>summary ————————————————————— • margot</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Fira_Code-0.4.10/font.css" rel="stylesheet"><link href="deps/Fira_Sans-0.4.10/font.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="summary —————————————————————"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">margot</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.240</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/go-bayes/margot/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>summary —————————————————————</h1>
      <small class="dont-index">Source: <a href="https://github.com/go-bayes/margot/blob/HEAD/margotverse-plan.md" class="external-link"><code>margotverse-plan.md</code></a></small>
    </div>


<div id="summary-" class="section level1">

</div>
<div class="section level1">
<h1 id="this-script-is-a-strategic-blueprint-for-evolving-the-original-margot">this script is a strategic blueprint for evolving the original <code>margot</code>
<a class="anchor" aria-label="anchor" href="#this-script-is-a-strategic-blueprint-for-evolving-the-original-margot"></a></h1>
</div>
<div class="section level1">
<h1 id="monolith-into-a-coherent-ecosystem--the-margotverse--composed-of">monolith into a coherent ecosystem – the <strong>margotverse</strong> – composed of<a class="anchor" aria-label="anchor" href="#monolith-into-a-coherent-ecosystem--the-margotverse--composed-of"></a></h1>
</div>
<div class="section level1">
<h1 id="lean-interoperable-packages-that-share-a-common-grammar-data-contract">lean, interoperable packages that share a common grammar, data contract,<a class="anchor" aria-label="anchor" href="#lean-interoperable-packages-that-share-a-common-grammar-data-contract"></a></h1>
</div>
<div class="section level1">
<h1 id="and-build-infrastructure-like-pruning-a-venerable-but-overgrown-vine">and build infrastructure. like pruning a venerable but over‑grown vine,<a class="anchor" aria-label="anchor" href="#and-build-infrastructure-like-pruning-a-venerable-but-overgrown-vine"></a></h1>
</div>
<div class="section level1">
<h1 id="we-keep-only-the-branches-that-bear-fruit-graft-them-onto-stronger">we keep only the branches that bear fruit, graft them onto stronger<a class="anchor" aria-label="anchor" href="#we-keep-only-the-branches-that-bear-fruit-graft-them-onto-stronger"></a></h1>
</div>
<div class="section level1">
<h1 id="rootstock-and-train-new-shoots-along-a-tidy-trellis-the-endstate-is">rootstock, and train new shoots along a tidy trellis. the end‑state is<a class="anchor" aria-label="anchor" href="#rootstock-and-train-new-shoots-along-a-tidy-trellis-the-endstate-is"></a></h1>
</div>
<div class="section level1">
<h1 id="a-stack-that-is-easier-to-test-maintain-and-extend-while-retaining">a stack that is easier to test, maintain, and extend, while retaining<a class="anchor" aria-label="anchor" href="#a-stack-that-is-easier-to-test-maintain-and-extend-while-retaining"></a></h1>
</div>
<div class="section level1">
<h1 id="continuity-for-users-and-the-lab">continuity for users and the lab.<a class="anchor" aria-label="anchor" href="#continuity-for-users-and-the-lab"></a></h1>
</div>
<div class="section level1">
<h1 id="guiding-principles--">guiding principles —————————————————-<a class="anchor" aria-label="anchor" href="#guiding-principles--"></a></h1>
</div>
<div class="section level1">
<h1 id="id_1-explicit-dependencies--favour-minimal-imports-and-optional">1. <strong>explicit dependencies</strong> – favour minimal imports and optional<a class="anchor" aria-label="anchor" href="#id_1-explicit-dependencies--favour-minimal-imports-and-optional"></a></h1>
</div>
<div class="section level1">
<h1 id="suggests-manage-them-perpackage-with-renv">‘suggests’; manage them per‑package with {renv}.<a class="anchor" aria-label="anchor" href="#suggests-manage-them-perpackage-with-renv"></a></h1>
</div>
<div class="section level1">
<h1 id="id_2-singleresponsibility-packages--each-repo-does-one-thing">2. <strong>single‑responsibility packages</strong> – each repo does one thing<a class="anchor" aria-label="anchor" href="#id_2-singleresponsibility-packages--each-repo-does-one-thing"></a></h1>
</div>
<div class="section level1">
<h1 id="extremely-well-a-la-tidyverse-design-philosophy">extremely well, a la tidyverse design philosophy.<a class="anchor" aria-label="anchor" href="#extremely-well-a-la-tidyverse-design-philosophy"></a></h1>
</div>
<div class="section level1">
<h1 id="id_3-shared-core-objects--a-light-s3-class-margot_panel-defines">3. <strong>shared core objects</strong> – a light s3 class (<code>margot_panel</code>) defines<a class="anchor" aria-label="anchor" href="#id_3-shared-core-objects--a-light-s3-class-margot_panel-defines"></a></h1>
</div>
<div class="section level1">
<h1 id="panel-data-helpers-live-in-margotcore-all-other-packages-import">panel data; helpers live in <code>margot.core</code>. all other packages import<a class="anchor" aria-label="anchor" href="#panel-data-helpers-live-in-margotcore-all-other-packages-import"></a></h1>
</div>
<div class="section level1">
<h1 id="but-do-not-modify-this-class">but do <strong>not</strong> modify this class.<a class="anchor" aria-label="anchor" href="#but-do-not-modify-this-class"></a></h1>
</div>
<div class="section level1">
<h1 id="id_4-pipelines-over-scripts--long-simulations-and-estimation-workflows">4. <strong>pipelines over scripts</strong> – long simulations and estimation workflows<a class="anchor" aria-label="anchor" href="#id_4-pipelines-over-scripts--long-simulations-and-estimation-workflows"></a></h1>
</div>
<div class="section level1">
<h1 id="live-in-targets-pipelines-for-reproducibility-and-lazy-rebuilds">live in <em>targets</em> pipelines for reproducibility and lazy re‑builds.<a class="anchor" aria-label="anchor" href="#live-in-targets-pipelines-for-reproducibility-and-lazy-rebuilds"></a></h1>
</div>
<div class="section level1">
<h1 id="section"></h1>
</div>
<div class="section level1">
<h1 id="id_5-continuous-documentation--each-package-gets-its-own-pkgdown">5. <strong>continuous documentation</strong> – each package gets its own {pkgdown}<a class="anchor" aria-label="anchor" href="#id_5-continuous-documentation--each-package-gets-its-own-pkgdown"></a></h1>
</div>
<div class="section level1">
<h1 id="site-a-metasite-at-margotverseorg-aggregates-reference-indices">site; a meta‑site at <code>margotverse.org</code> aggregates reference indices<a class="anchor" aria-label="anchor" href="#site-a-metasite-at-margotverseorg-aggregates-reference-indices"></a></h1>
</div>
<div class="section level1">
<h1 id="via-a-pkgdown-articles-collection">via a pkgdown “articles” collection.<a class="anchor" aria-label="anchor" href="#via-a-pkgdown-articles-collection"></a></h1>
</div>
<div class="section level1">
<h1 id="id_6-literate-results--reporting-is-powered-by-boilerplate-">6. <strong>literate results</strong> – reporting is powered by {boilerplate} +<a class="anchor" aria-label="anchor" href="#id_6-literate-results--reporting-is-powered-by-boilerplate-"></a></h1>
</div>
<div class="section level1">
<h1 id="quarto-templates-so-manuscripts-remain-executable">Quarto templates so manuscripts remain executable.<a class="anchor" aria-label="anchor" href="#quarto-templates-so-manuscripts-remain-executable"></a></h1>
</div>
<div class="section level1">
<h1 id="highlevel-package-map-">high‑level package map ———————————————–<a class="anchor" aria-label="anchor" href="#highlevel-package-map-"></a></h1>
<p>margotverse_map &lt;- list( margot.core = c(“panel data class”, “coercion + validation”), margot.wrangle = c(“long‑to‑wide”, “missing data tags”), margot.sim = c(“data‑generating mechanisms”, “diagnostic plots”), margot.lmtp = c(“batch lmtp estimators”, “assumption checks”), # margot.grf = c(“batch causal &amp; policy forests”, “effect heterogeneity”), # margot.viz = c(“graphs, tables, text”, “tidy presentation”), margot.report= c(“boilerplate templates”, “quarto helpers”), margotverse = c(“meta‑package umbrella”, “imports all above”) )</p>
</div>
<div class="section level1">
<h1 id="helper-create-a-skeleton-subpackage-">helper: create a skeleton sub‑package ———————————<a class="anchor" aria-label="anchor" href="#helper-create-a-skeleton-subpackage-"></a></h1>
<p>setup_subpackage &lt;- function(path, licence = “MIT”, open = FALSE) { # creates a bare package using usethis ——————————- if (!requireNamespace(“usethis”, quietly = TRUE)) stop(“install usethis first”) usethis::create_package(path, open = open) # usethis::use_mit_license(“Joseph A.Bulbulia”) usethis::use_git() usethis::use_github(repo_spec = paste0(“go-bayes/”, basename(path))) # initialise renv for isolated deps ———————————- renv::init(bare = TRUE) # # add standard ci, pkgdown ——————————————- usethis::use_github_action_check_standard() usethis::use_pkgdown() }</p>
</div>
<div class="section level1">
<h1 id="helper-declare-common-imports-">helper: declare common imports —————————————<a class="anchor" aria-label="anchor" href="#helper-declare-common-imports-"></a></h1>
<p>add_core_dep &lt;- function(pkg_path) { desc &lt;- file.path(pkg_path, “DESCRIPTION”) usethis::use_package(“margot.core”, type = “Imports”, pkg = pkg_path) usethis::use_package(“rlang”, type = “Imports”, pkg = pkg_path) }</p>
</div>
<div class="section level1">
<h1 id="define-the-shared-s3-class--">define the shared s3 class ——————————————-<a class="anchor" aria-label="anchor" href="#define-the-shared-s3-class--"></a></h1>
<p>#’ construct a margot_panel object #’ @param data a data.frame in long format #’ @param id unit identifier #’ @param time time index #’ @return an object of class margot_panel margot_panel &lt;- function(data, id, time) { stopifnot(all(c(id, time) %in% names(data))) structure( data, id_col = id, time_col = time, class = c(“margot_panel”, class(data)) ) }</p>
</div>
<div class="section level1">
<h1 id="method-convert-to-wide--">method: convert to wide ———————————————-<a class="anchor" aria-label="anchor" href="#method-convert-to-wide--"></a></h1>
<p>as_wide.margot_panel &lt;- function(x, keep_ids = TRUE) { tidyr::pivot_wider( x, id_cols = attr(x, “id_col”), names_from = attr(x, “time_col”), values_fn = dplyr::first ) }</p>
</div>
<div class="section level1">
<h1 id="targets-pipeline-template-">targets pipeline template ——————————————–<a class="anchor" aria-label="anchor" href="#targets-pipeline-template-"></a></h1>
</div>
<div class="section level1">
<h1 id="inside-each-analysis-repo-create-_targetsr">inside each analysis repo create _targets.R<a class="anchor" aria-label="anchor" href="#inside-each-analysis-repo-create-_targetsr"></a></h1>
<p>write_targets_template &lt;- function(path = “analysis/_targets.R”) { lines &lt;- c( “library(targets)”, “library(margot.lmtp)”, # bring your estimators “tar_option_set(packages = c(‘margot.core’, ‘margot.wrangle’))”, ““,”list(“,” tar_target(raw, readr::read_csv(‘data/panel.csv’)),“,” tar_target(panel, margot_panel(raw, id = ‘participant’, time = ‘wave’)),“,” tar_target(wide, as_wide.margot_panel(panel)),“,” tar_target(lmtp_res, batch_lmtp(wide, spec_file = ‘analysis/spec.yml’))“,”)” ) dir.create(dirname(path), recursive = TRUE, showWarnings = FALSE) writeLines(lines, path) } # batch wrappers ——————————————————– batch_lmtp &lt;- function(data, spec_file) { # iterate over interventions defined in yaml, fit lmtp in parallel – spec &lt;- yaml::read_yaml(spec_file) future.apply::future_lapply( spec<span class="math inline">$interventions,
    \(pol) lmtp::lmtp_tmle(data = data, shift = pol$</span>fn, A = pol<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>,</mo><mi>Y</mi><mo>=</mo><mi>p</mi><mi>o</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">A, Y = pol</annotation></semantics></math>Y) ) }</p>
<p>batch_grf &lt;- function(data, treat, outcome, covars) { forest &lt;- grf::causal_forest( X = data[covars], Y = data[[outcome]], W = data[[treat]] ) grf::predict(forest)$predictions }</p>
</div>
<div class="section level1">
<h1 id="reporting-blueprint-">reporting blueprint —————————————————<a class="anchor" aria-label="anchor" href="#reporting-blueprint-"></a></h1>
</div>
<div class="section level1">
<h1 id="quarto--boilerplate-integration">quarto + boilerplate integration:<a class="anchor" aria-label="anchor" href="#quarto--boilerplate-integration"></a></h1>
</div>
<div class="section level1">
<h1 id="in-analysisreportqmd-embed">in <code>analysis/report.qmd</code> embed:<a class="anchor" aria-label="anchor" href="#in-analysisreportqmd-embed"></a></h1>
</div>
<div class="section level1">
<h1 id="section-1"></h1>
</div>
<div class="section level1">
<h1 id="r--libraryboilerplate--bp_render----template---methodslmtp----variables--listestimator--tmle-learners--superlearner---"><code>{r} # library(boilerplate) # bp_render( #   template  = "methods.lmtp", #   variables = list(estimator = "TMLE", learners = "SuperLearner") # ) #</code><a class="anchor" aria-label="anchor" href="#r--libraryboilerplate--bp_render----template---methodslmtp----variables--listestimator--tmle-learners--superlearner---"></a></h1>
</div>
<div class="section level1">
<h1 id="the-template-string-lives-in-insttemplatesmethodslmtpjson">the template string lives in <code>inst/templates/methods.lmtp.json</code>.<a class="anchor" aria-label="anchor" href="#the-template-string-lives-in-insttemplatesmethodslmtpjson"></a></h1>
</div>
<div class="section level1">
<h1 id="quarto-renders-narrative--tables-automatically">quarto renders narrative + tables automatically.<a class="anchor" aria-label="anchor" href="#quarto-renders-narrative--tables-automatically"></a></h1>
</div>
<div class="section level1">
<h1 id="metapackage-assembly--">meta‑package assembly ————————————————-<a class="anchor" aria-label="anchor" href="#metapackage-assembly--"></a></h1>
<p>build_margotverse &lt;- function() { if (!requireNamespace(“usethis”, quietly = TRUE)) stop(“usethis needed”) usethis::create_package(“margotverse”, open = FALSE) # usethis::use_description(fields = list( Title = “The margotverse”, Description = “A family of packages for longitudinal causal inference.” )) # import each child package but expose nothing; user attaches meta‑pkg for (pkg in names(margotverse_map)[-length(margotverse_map)]) { usethis::use_package(pkg, type = “Imports”, pkg = “margotverse”) } # convenience re‑exports usethis::use_package(“magrittr”, type = “Imports”, pkg = “margotverse”) cat(“margotverse skeleton created – remember to add a pkgdown site.”) }</p>
</div>
<div class="section level1">
<h1 id="dependency-hygiene--">dependency hygiene —————————————————-<a class="anchor" aria-label="anchor" href="#dependency-hygiene--"></a></h1>
</div>
<div class="section level1">
<h1 id="run-this-occasionally-in-each-repo-to-drop-unused-imports-">run this occasionally in each repo to drop unused imports ———–<a class="anchor" aria-label="anchor" href="#run-this-occasionally-in-each-repo-to-drop-unused-imports-"></a></h1>
<p>renv_clean &lt;- function() renv::dependencies() #</p>
</div>
<div class="section level1">
<h1 id="cultural-notes-">cultural notes ——————————————————–<a class="anchor" aria-label="anchor" href="#cultural-notes-"></a></h1>
</div>
<div class="section level1">
<h1 id="id_-avoid-loading-the-whole-margotverse-within-the-lowlevel-packages">* avoid loading the whole margotverse within the low‑level packages;<a class="anchor" aria-label="anchor" href="#id_-avoid-loading-the-whole-margotverse-within-the-lowlevel-packages"></a></h1>
</div>
<div class="section level1">
<h1 id="echo-the-tidyverse-decision-to-keep-dependencies-acyclic">echo the tidyverse decision to keep dependencies acyclic.<a class="anchor" aria-label="anchor" href="#echo-the-tidyverse-decision-to-keep-dependencies-acyclic"></a></h1>
</div>
<div class="section level1">
<h1 id="id_-expose-only-one-main-verb-per-package-eg-sim_-in-margotsim">* expose only one main verb per package (e.g., <code>sim_*</code> in margot.sim).<a class="anchor" aria-label="anchor" href="#id_-expose-only-one-main-verb-per-package-eg-sim_-in-margotsim"></a></h1>
</div>
<div class="section level1">
<h1 id="id_-dedicate-a-zzzr-that-sets-generic-options-but-does-not-attach">* dedicate a <code>zzz.R</code> that sets generic options but does <strong>not</strong> attach<a class="anchor" aria-label="anchor" href="#id_-dedicate-a-zzzr-that-sets-generic-options-but-does-not-attach"></a></h1>
</div>
<div class="section level1">
<h1 id="any-nonstrict-dependency">any non‑strict dependency.<a class="anchor" aria-label="anchor" href="#any-nonstrict-dependency"></a></h1>
</div>
<div class="section level1">
<h1 id="id_-publish-each-packages-site-via-githubpages-aggregate-reference">* publish each package’s site via GitHub‑Pages; aggregate reference<a class="anchor" aria-label="anchor" href="#id_-publish-each-packages-site-via-githubpages-aggregate-reference"></a></h1>
</div>
<div class="section level1">
<h1 id="tabs-with-custom-navbar-links-in-the-umbrella-site">tabs with custom navbar links in the umbrella site.<a class="anchor" aria-label="anchor" href="#tabs-with-custom-navbar-links-in-the-umbrella-site"></a></h1>
</div>
<div class="section level1">
<h1 id="execution--">execution ————————————————————-<a class="anchor" aria-label="anchor" href="#execution--"></a></h1>
</div>
<div class="section level1">
<h1 id="run-these-interactively-to-scaffold-the-ecosystem-">run these interactively to scaffold the ecosystem ——————–<a class="anchor" aria-label="anchor" href="#run-these-interactively-to-scaffold-the-ecosystem-"></a></h1>
</div>
<div class="section level1">
<h1 id="setup_subpackagemargotcore">setup_subpackage(“margot.core”)<a class="anchor" aria-label="anchor" href="#setup_subpackagemargotcore"></a></h1>
</div>
<div class="section level1">
<h1 id="setup_subpackagemargotwrangle">setup_subpackage(“margot.wrangle”)<a class="anchor" aria-label="anchor" href="#setup_subpackagemargotwrangle"></a></h1>
</div>
<div class="section level1">
<h1 id="setup_subpackagemargotsim">setup_subpackage(“margot.sim”)<a class="anchor" aria-label="anchor" href="#setup_subpackagemargotsim"></a></h1>
</div>
<div class="section level1">
<h1 id="setup_subpackagemargotlmtp">setup_subpackage(“margot.lmtp”)<a class="anchor" aria-label="anchor" href="#setup_subpackagemargotlmtp"></a></h1>
</div>
<div class="section level1">
<h1 id="setup_subpackagemargotgrf">setup_subpackage(“margot.grf”)<a class="anchor" aria-label="anchor" href="#setup_subpackagemargotgrf"></a></h1>
</div>
<div class="section level1">
<h1 id="setup_subpackagemargotviz">setup_subpackage(“margot.viz”)<a class="anchor" aria-label="anchor" href="#setup_subpackagemargotviz"></a></h1>
</div>
<div class="section level1">
<h1 id="setup_subpackagemargotreport">setup_subpackage(“margot.report”)<a class="anchor" aria-label="anchor" href="#setup_subpackagemargotreport"></a></h1>
</div>
<div class="section level1">
<h1 id="build_margotverse">build_margotverse()<a class="anchor" aria-label="anchor" href="#build_margotverse"></a></h1>
</div>
<div class="section level1">
<h1 id="when-we-next-devtoolsload_all-inside-a-child-package-renv-will">when we next <code>devtools::load_all()</code> inside a child package, renv will<a class="anchor" aria-label="anchor" href="#when-we-next-devtoolsload_all-inside-a-child-package-renv-will"></a></h1>
</div>
<div class="section level1">
<h1 id="capture-the-exact-versions-and-targets-will-orchestrate-the-heavy">capture the exact versions, and targets will orchestrate the heavy<a class="anchor" aria-label="anchor" href="#capture-the-exact-versions-and-targets-will-orchestrate-the-heavy"></a></h1>
</div>
<div class="section level1">
<h1 id="lifting--leaving-us-free-to-cultivate-new-methodological-vines">lifting – leaving us free to cultivate new methodological vines<a class="anchor" aria-label="anchor" href="#lifting--leaving-us-free-to-cultivate-new-methodological-vines"></a></h1>
</div>
<div class="section level1">
<h1 id="without-tangling-the-trellis">without tangling the trellis.<a class="anchor" aria-label="anchor" href="#without-tangling-the-trellis"></a></h1>
</div>


  </main></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/go-bayes" class="external-link">Joseph A Bulbulia</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

