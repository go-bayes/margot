% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/margot_wide_machine.R
\name{margot_wide_machine}
\alias{margot_wide_machine}
\title{Transform longitudinal data to wide format with flexible wave handling and imputation}
\usage{
margot_wide_machine(
  .data,
  id = "id",
  wave = "wave",
  baseline_vars,
  exposure_var,
  outcome_vars,
  confounder_vars = NULL,
  make_na_dummies = NULL,
  not_lost_following_wave = NULL,
  imputation_method = "median",
  include_exposure_var_baseline = TRUE,
  include_outcome_vars_baseline = TRUE
)
}
\arguments{
\item{.data}{A data frame containing the longitudinal data in long format.}

\item{id}{The name of the ID column identifying subjects (default is "id").}

\item{wave}{The name of the wave/time column (default is "wave").}

\item{baseline_vars}{A character vector of baseline variable names to be included at t0.}

\item{exposure_var}{A character string specifying the name of the exposure variable to be tracked across time.}

\item{outcome_vars}{A character vector of outcome variable names to be tracked across time.}

\item{confounder_vars}{An optional character vector of time-varying confounder variable names.}

\item{make_na_dummies}{An optional character vector of variable names or keywords ("baseline_vars", "confounder_vars") for which to create NA dummies.}

\item{not_lost_following_wave}{A character string specifying the name of the variable to check for non-missing status across waves (default is NULL).}

\item{imputation_method}{A character string specifying the imputation method to use. Options are 'median' (default), 'mice', or 'none'.}
}
\value{
A wide-format data frame with each subject's observations across time points
        represented in a single row, and variables prefixed by their respective
        time of measurement. Imputed values and NA indicators are included as specified.
}
\description{
This function transforms longitudinal data from long format to wide format,
ensuring that baseline measurements are correctly labelled and included.
It handles multiple observations per subject across an indefinite number of waves,
and allows for the specification of baseline variables, exposure variables,
outcome variables, and time-varying confounders. The function also performs
imputation for missing values and creates NA indicator variables as specified.
}
\details{
Imputation methods:
- 'median': For numeric variables, missing values are imputed with the median.
            For categorical variables, missing values are imputed with the mode.
- 'mice': Multiple Imputation by Chained Equations is used for baseline variables.
          If MICE fails, the function falls back to median/mode imputation.
- 'none': No imputation is performed.

The function creates NA indicator variables for specified variables, imputes
missing values according to the chosen method, and ensures that the exposure
variable is not imputed after t0 and outcome variables are not imputed at the
final time point.
}
\examples{
# Define variables
baseline_vars <- c("age", "education", "income")
exposure_var <- "treatment"
outcome_vars <- c("health_score", "quality_of_life")
confounder_vars <- c("stress_level", "exercise_frequency")

# Transform data to wide format with imputation
df_wide_impute <- margot_wide_machine(
  longitudinal_data,
  id = "patient_id",
  wave = "visit_time",
  baseline_vars = baseline_vars,
  exposure_var = exposure_var,
  outcome_vars = outcome_vars,
  confounder_vars = confounder_vars,
  make_na_dummies = c("baseline_vars", "confounder_vars"),
  not_lost_following_wave = "follow_up_complete",
  imputation_method = "mice"
)
}
