% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/margot_recalculate_policy_trees.R
\name{margot_recalculate_policy_trees}
\alias{margot_recalculate_policy_trees}
\title{Recalculate Policy Trees with Custom Covariates}
\usage{
margot_recalculate_policy_trees(
  model_results,
  outcomes_to_recalculate = NULL,
  custom_covariates = NULL,
  exclude_covariates = NULL,
  covariate_mode = c("original", "custom", "add", "all"),
  model_prefix = "model_",
  verbose = TRUE,
  parallel = FALSE,
  n_cores = future::availableCores() - 1,
  seed = 12345
)
}
\arguments{
\item{model_results}{A list containing the model results from margot_causal_forest().}

\item{outcomes_to_recalculate}{Character vector of outcome names to recalculate.
If NULL (default), recalculates all models marked as needing recalculation.}

\item{custom_covariates}{Character vector of covariate names to use for policy trees.
If NULL, uses the original top variables from the model.}

\item{exclude_covariates}{Character vector of covariate names or patterns to exclude.
Supports exact matches and regex patterns (e.g., "^t0_log_" excludes all 
variables starting with "t0_log_").}

\item{covariate_mode}{Character string specifying how to handle covariates:
\itemize{
  \item{"original"}{Use original top variables from model (default)}
  \item{"custom"}{Use only the specified custom_covariates}
  \item{"add"}{Add custom_covariates to existing top variables}
  \item{"all"}{Use all available covariates}
}}

\item{model_prefix}{Character string prefix for model names. Default is "model_".}

\item{verbose}{Logical indicating whether to display messages. Default is TRUE.}

\item{parallel}{Logical indicating whether to use parallel processing. Default is FALSE.}

\item{n_cores}{Number of cores for parallel processing. Default is availableCores() - 1.}

\item{seed}{Random seed for reproducibility. Default is NULL.}
}
\value{
A modified copy of model_results with recalculated policy trees.
}
\description{
This function allows recalculation of policy trees using custom covariate sets.
It provides flexibility to explore different covariate specifications for
policy tree estimation while maintaining the original causal forest results.
}
\details{
This function is useful for:
\itemize{
  \item Exploring sensitivity of policy recommendations to covariate selection
  \item Excluding covariates with measurement error or other concerns
  \item Using domain knowledge to select policy-relevant covariates
  \item Testing robustness of policy tree findings
}

The function preserves all original model results and only updates:
\itemize{
  \item policy_tree_depth_1: Single-split policy tree
  \item policy_tree_depth_2: Two-split policy tree (if â‰¥2 covariates)
  \item plot_data: Data for visualization
  \item Metadata about which covariates were used
}
}
\examples{
\dontrun{
# recalculate with custom covariates
results_custom <- margot_recalculate_policy_trees(
  model_results,
  custom_covariates = c("age", "gender", "income"),
  covariate_mode = "custom"
)

# exclude measurement error variables
results_clean <- margot_recalculate_policy_trees(
  model_results,
  exclude_covariates = c("bmi", "^log_"),
  covariate_mode = "original"
)

# use all covariates
results_all <- margot_recalculate_policy_trees(
  model_results,
  covariate_mode = "all"
)
}

}
