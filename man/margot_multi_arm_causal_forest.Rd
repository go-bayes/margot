% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/margot_multi_arm_causal_forest.R
\name{margot_multi_arm_causal_forest}
\alias{margot_multi_arm_causal_forest}
\title{Run Multiple Generalized Random Forest (GRF) Multi-Arm Causal Forest Models with Enhanced Features
Run Multiple Generalized Random Forest (GRF) Multi-Arm Causal Forest Models with Enhanced Features}
\usage{
margot_multi_arm_causal_forest(
  data,
  outcome_vars,
  covariates,
  W_multi,
  weights,
  exposure_name,
  grf_defaults = list(),
  save_data = FALSE,
  top_n_vars = 20,
  save_models = FALSE,
  compute_qini = TRUE,
  train_proportion = 0.7,
  W.hat = NULL,
  cost = NULL,
  verbose = TRUE
)
}
\arguments{
\item{data}{A data frame containing all necessary variables.}

\item{outcome_vars}{A character vector of outcome variable names to be modeled.}

\item{covariates}{A matrix of covariates to be used in the GRF models.}

\item{W_multi}{A factor vector of multi-arm treatment assignments.}

\item{weights}{A vector of weights for the observations.}

\item{exposure_name}{A character string specifying the name of the exposure variable.}

\item{grf_defaults}{A list of default parameters for the GRF models.}

\item{save_data}{Logical indicating whether to save data, covariates, and weights. Default is FALSE.}

\item{top_n_vars}{Integer specifying the number of top variables to use for additional computations. Default is 10.}

\item{save_models}{Logical indicating whether to save the full GRF model objects. Default is FALSE.}

\item{compute_qini}{Logical indicating whether to compute Qini curves for each model. Default is TRUE.}

\item{train_proportion}{Numeric value between 0 and 1 indicating the proportion of non-missing data to use for training policy trees. Default is 0.7.}

\item{W.hat}{Optional vector specifying known treatment assignment probabilities for each arm.}

\item{cost}{Optional vector specifying the cost associated with each treatment arm.}

\item{verbose}{Logical indicating whether to display detailed messages during execution. Default is TRUE.}
}
\value{
A list containing:
  \item{results}{A list of model results, one for each outcome variable. Each model result includes:
    \itemize{
      \item{ate}{Average treatment effect}
      \item{custom_table}{Custom evaluation table}
      \item{tau_hat}{Individual treatment effect estimates}
      \item{top_vars}{Top variables by importance}
      \item{variable_importance}{Data frame of variable importance rankings}
      \item{dr_scores}{Double robust scores}
      \item{policy_tree_depth_2}{Policy tree of depth 2, trained on train_proportion of non-missing data}
      \item{plot_data}{Data prepared for policy tree visualization, using the remaining proportion of non-missing data}
      \item{qini_data}{Data frame containing Qini curve data for plotting (if compute_qini is TRUE)}
      \item{qini_objects}{List of maq objects for each curve, used for computing average gain}
    }
  }
  \item{combined_tables}{A list of data frames combining custom evaluation tables grouped by comparison levels.}
  \item{outcome_vars}{The character vector of outcome variable names that were modeled.}
  \item{not_missing}{A vector of indices for complete cases.}
  \item{exposure_name}{The name of the exposure variable.}
  \item{data}{The input data (if save_data is TRUE).}
  \item{covariates}{The input covariates (if save_data is TRUE).}
  \item{weights}{The input weights (if save_data is TRUE).}
  \item{full_models}{A list of full GRF model objects (if save_models is TRUE).}
}
\description{
This function is a wrapper for grf::multi_arm_causal_forest that runs multiple GRF multi-arm causal forest models
for specified outcome variables. It calculates average treatment effects, creates custom evaluation tables,
and includes additional features such as tau.hat estimates, policy trees, variable importance rankings,
and Qini curves. It also prepares data for policy tree visualization, using a specified proportion of the data for training.
}
\note{
Setting save_models = TRUE typically results in very large objects (often several GB).
      Ensure you have sufficient memory available when using this option.
}
\examples{
\dontrun{
result_multi_arm <- margot_multi_arm_causal_forest(
  data = df_grf,
  outcome_vars = outcomes,
  covariates = X,
  W_multi = W_multi,
  weights = weights,
  exposure_name = "treatment",
  grf_defaults = list(num.trees = 2000),
  top_n_vars = 15,
  train_proportion = 0.5,
  save_models = TRUE,
  W.hat = c(0.4, 0.3, 0.3),  # Example treatment assignment probabilities
  cost = c(1, 2, 3),         # Example costs for each treatment arm
  verbose = TRUE
)
}

}
